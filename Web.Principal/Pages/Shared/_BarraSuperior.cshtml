@using ViewModel.Datos.UsuarioRegistro
@using ViewModel.Datos.Acceso 
@{
    int IdPerfil = Convert.ToInt32(ViewData["IdPerfil"]);
    
    string PerfilNombre = ViewData["PerfilNombre"].ToString();
    var RucRazon = ViewData["RucRazonSocial"].ToString();

    var AdminSistema = ViewData["AdminSistema"].ToString();
    var ModoAdminSistema = ViewData["ModoAdminSistema"].ToString();
    
    ListarTransGroupEmpresaVM EmpresasSesion = ViewData["EmpresasSesion"] as ListarTransGroupEmpresaVM;
    List<PerfilLoginVM> PerfilesSesion = ViewData["PerfilesSesion"] as List<PerfilLoginVM>;
    var NombreEmpresaTrans = ViewData["EmpresaTransmaresSelct"].ToString();
    var ImagenEmpresaTransmaresSelct = ViewData["ImagenEmpresaTransmaresSelct"].ToString();

}

<nav class="topnav navbar navbar-expand shadow justify-content-between justify-content-sm-start navbar-light bg-white" id="sidenavAccordion">
    <!-- Sidenav Toggle Button-->
    <button class="btn btn-icon btn-transparent-dark order-1 order-lg-0 me-2 ms-lg-2 me-lg-0" id="sidebarToggle"><i data-feather="menu"></i></button>

    <a class="navbar-brand" href="@Url.Action("Home","Inicio",new {  area="GestionarDashboards"})">      <img src="~/img/@ImagenEmpresaTransmaresSelct" style="height:59px!important" />  </a>

    <form class="form-inline me-auto d-none d-lg-block me-3" style="background-color:none!important">
        <div class="input-group">
            @if (AdminSistema == "1")
            {
                if (ModoAdminSistema.Equals(Utilitario.Constante.SeguridadConstante.ModoVisualizacion.ADMINISTRADOR))
                {
            <button class="btn btn-sm btn-outline-dark" onclick="ListarEntidadTipo()" id="btnSuperBarListarEntidadTipo" type="button">
                <span class="spinner-border spinner-border-sm" style="display:none" id="spinnerSuperBarListarEntidadTipo" role="status" aria-hidden="true"></span>     Seleccionar Entidad
            </button>
                   
                }
                else
                {
                    <div>
                        @RucRazon
                    </div>
                 
                    <div>
                        &nbsp;
                        <button class="btn btn-sm btn-outline-dark" onclick="CerrarSesionModo()" id="btnSuperCerrarSesionModo" type="button">
                            <span class="spinner-border spinner-border-sm" style="display:none" id="spinnerSuperBarCerrarSesionModo" role="status" aria-hidden="true"></span>     Cerrar
                        </button>
                    </div>
                }
            }
            else
            {
                @RucRazon
            }

        </div>

</form>

    <ul class="navbar-nav align-items-center ms-auto">
        <!-- Documentation Dropdown-->
        <li class="nav-item dropdown no-caret d-none d-md-block me-2 py-1 px-1 ">
            @if (PerfilesSesion != null)
            {
                if (PerfilesSesion.Count() > 1)
                {
                    <a class="nav-link dropdown-toggle" id="navbarDropdownDocs" href="javascript:void(0);" role="button" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        <div class="fw-500">Perfil: <b>@PerfilNombre</b></div>
                        <i class="fas fa-chevron-right dropdown-arrow"></i>
                    </a>
                    <div class="dropdown-menu dropdown-menu-end py-0 me-sm-n15 me-lg-0 o-hidden animated--fade-in-up" aria-labelledby="navbarDropdownDocs">
                        @foreach (var item in PerfilesSesion)
                        {
                            if (item.IdPerfil == IdPerfil)
                            {
                                <a class="dropdown-item py-3 active" href="javascript:void(0)">
                                    <div class="icon-stack bg-primary-soft text-primary me-4"><i data-feather="user"></i></div>
                                    <div>
                                        @item.Nombre
                                    </div>
                                </a>
                            }
                            else
                            {
                                <a class="dropdown-item py-3" href="javascript:void(0)" onclick="CambiarPerfil(@item.IdPerfil)">
                                    <div class="icon-stack bg-primary-soft text-primary me-4"><i data-feather="user"></i></div>
                                    <div>
                                        @item.Nombre
                                    </div>
                                </a>
                            }

                            <div class="dropdown-divider m-0"></div>
                        }
                    </div>
                }
                else
                {
                    <a class="nav-link dropdown-toggle" id="navbarDropdownDocs" href="javascript:void(0);" role="button" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        <div class="fw-500">Perfil: <b>@PerfilNombre</b></div>
                    </a>
                }
            }
        </li>

        <li class="nav-item dropdown no-caret d-none d-md-block me-2">
            <a class="nav-link dropdown-toggle" id="navbarDropdownDocs" href="javascript:void(0);" role="button" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                <div class="fw-500">Empresa</div>
                <i class="fas fa-chevron-right dropdown-arrow"></i>
            </a>

            <div class="dropdown-menu dropdown-menu-end py-0 me-sm-n15 me-lg-0 o-hidden animated--fade-in-up" aria-labelledby="navbarDropdownDocs">

                @foreach (var itemEmpresa in EmpresasSesion.Empresa)
                {
                    <a class="dropdown-item py-3" href="javascript:CambiarEmpresa('@itemEmpresa.Codigo')" >
                        <div class="icon-stack bg-primary-soft text-primary me-4 small"> @itemEmpresa.Codigo</div>
                        <div class="small">
                           @itemEmpresa.Nombres
                        </div>
                    </a>
                    <div class="dropdown-divider m-0"></div>

                }

            </div>

        </li>

        <li class="nav-item dropdown no-caret d-none d-sm-block me-3 dropdown-notifications" id="contentNotififacion">
            <a class="btn btn-icon btn-transparent-dark dropdown-toggle" id="navbarDropdownAlerts" href="javascript:void(0);" role="button" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><i data-feather="bell"></i> <span class="badge bg-danger text-white ms-auto" style="position: absolute; left: 27px; top: 3px; " id="alertCantidad"></span> </a>
            <div class="dropdown-menu dropdown-menu-end border-0 shadow animated--fade-in-up" aria-labelledby="navbarDropdownAlerts">
                <h6 class="dropdown-header dropdown-notifications-header">
                    <i class="me-2" data-feather="bell"></i>
                    Alertas
                </h6>


                <div id="divListAlertas">
                   

      
          
                </div>


                <a class="dropdown-item dropdown-notifications-footer" href="#!">Ver todas las alertas</a>

                <p id="user" style="display:none"></p>
                <input type="hidden" id="signalRConnectionId" />

            </div>
        </li>


        <!-- User Dropdown-->
        <li class="nav-item dropdown no-caret dropdown-user me-3 me-lg-4">
            <a class="btn btn-icon btn-transparent-dark dropdown-toggle" id="navbarDropdownUserImage" href="javascript:void(0);" role="button" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><img class="img-fluid" src="~/img/illustrations/profiles/profile-1.png" /></a>
            <div class="dropdown-menu dropdown-menu-end border-0 shadow animated--fade-in-up" aria-labelledby="navbarDropdownUserImage">
                <h6 class="dropdown-header d-flex align-items-center">
                    <img class="dropdown-user-img" src="~/img/illustrations/profiles/profile-1.png" />
                    <div class="dropdown-user-details">
                        <div class="dropdown-user-details-name">@ViewData["NombreUsuario"]</div>
                        <div class="dropdown-user-details-email">@ViewData["CorreoUsuario"]</div>


                    </div>
                </h6>
                <div class="dropdown-divider"></div>

                <a class="dropdown-item" href="@Url.Action("CuentaUsuario","Usuario",new { area="GestionarUsuarios"})">
                    <div class="dropdown-item-icon"><i data-feather="settings"></i></div>
                    Mi cuenta
                </a>

                <a class="dropdown-item" href="@Url.Action("CambiarContrasenia","Usuario", new {area="GestionarUsuarios", nuevo="0" })">
                    <div class="dropdown-item-icon"><i data-feather="settings"></i></div>
                    Cambiar contraseña
                </a>

                <a class="dropdown-item" href="@Url.RouteUrl("CerrarSesionAsync")">
                    <div class="dropdown-item-icon"><i data-feather="log-out"></i></div>
                    Cerrar sesión
                </a>
            </div>
        </li>
    </ul>
</nav>
<form id="frmCambiarPerfil" asp-area="GestionarDashboards" asp-controller="inicio" asp-action="CambiarPerfil" method="post">
    <input id="IdPerfilSesion" name="IdPerfil" type="hidden" value="0" />
</form>
<form id="frmCambiarEmpresa" asp-area="GestionarDashboards" asp-controller="inicio" asp-action="CambiarEmpresa" method="post">
    <input id="CodigoEmpresa" name="CodigoEmpresa" type="hidden" value="0" />
</form>
