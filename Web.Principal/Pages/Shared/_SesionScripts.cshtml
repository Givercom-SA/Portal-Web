
@using Microsoft.Extensions.Configuration
@inject IConfiguration Configuration
 

@{ 
    var NombreEmpresaTrans = ViewData["EmpresaTransmaresSelct"].ToString();
}

<script type="text/javascript">

    var nombreEmpresaSeleccionado = "@NombreEmpresaTrans";

    $(document).ready(function () {

            $(document).ajaxError(function (event, jqxhr, settings) {
                if (jqxhr.status == 408) {
                    url = '@Url.RouteUrl("cerrarsesionasync")',
                    window.location.href = url;
                }
            });

            $.sessionTimeout({
                logoutButton: 'Cerrar Sesión',
                keepAliveButton: 'Seguir conectado',
                logoutUrl: '@Url.RouteUrl("cerrarsesionasync")',
                redirUrl: '@Url.RouteUrl("PaginaExpirada")',
                warnAfter: @(Convert.ToInt32(Configuration.GetSection("Session")["TimeExpired"]) * 1e3 - 65e3),
                redirAfter: @(Convert.ToInt32(Configuration.GetSection("Session")["TimeExpired"]) * 1e3 - 5e3),
                countdownBar: true
            });


        if (nombreEmpresaSeleccionado=="")
        {
         $("#modalEmpresaTransmares").modal("show");
        }


    });

    function sessionKeepAlive() {

            $.get("@Url.RouteUrl("KeepAlive")", function (data) { });
      }

    function listarClientes() {

        try {

            let dtsClientes = new simpleDatatables.DataTable("#dtsClientes", {
                searchable: true,
                labels: {
                    "noRows": "No hay información",
                    perPage: "{select} Registros por página",
                    "info": "Mostrando {start} a {end} de {rows} Registros",
                    placeholder: "Filtro rápido...",
                },
            });

        } catch (err) {

        }

    }

    function ListarEntidadTipo() {

        $.ajax({
            type: "GET",
            url: "@Url.Action("ListarEntidadTipo", "Entidad",new { area="GestionarEmbarques"})",
            data: null,
            async: true,
            contentType: 'application/html; charset=utf-8',
            type: 'GET',
            dataType: 'html',
            beforeSend: function () {

                $("#btnSuperBarListarEntidadTipo").prop("disabled", true);
                $("#spinnerSuperBarListarEntidadTipo").show();

            },
            error: function (jqXHR, textStatus, errorThrown) {

                $("#btnSuperBarListarEntidadTipo").prop("disabled", false);
                $("#spinnerSuperBarListarEntidadTipo").hide();

                $("#dialogPrincipalError").modal("show");

                if (jqXHR.status == 401) {
                    $("#outputMensajePrincipalError").html("@Utilitario.Constante.SistemaConstante.Error.YouDoNotHaveAccess");
                } else {
                    $("#outputMensajePrincipalError").html("Estimado usuario, ocurrio un error inesperado detalle: "+ textStatus + " - " + errorThrown);
                }

            },
            success: function (response) {

                $("#btnSuperBarListarEntidadTipo").prop("disabled", false);
                $("#spinnerSuperBarListarEntidadTipo").hide();

                $("#modelEntidades").modal("show");
                $("#divContentEnitdad").html(response);

                ListarEntidadTipoDataTable();

            },
            complete: function (data) {
                $(".loader").fadeOut("slow");

            }
        });

     }

    function ListarEntidadTipoDataTable() {

        try {


            new simpleDatatables.DataTable("#dtListarEntidadTipo", {
                searchable: true,
                labels: {
                    "noRows": "No hay información",
                    perPage: "{select} Registros por página",
                    "info": "Mostrando {start} a {end} de {rows} Registros",
                    placeholder: "Filtro rápido...",
                },
            });
        }
        catch (Erro) {


        }

    }

    function SeleccionarEntidad(IdEntidad, IdPerfil, Contador) {



        $.ajax({

             url: '@Url.Action("CambiarSessionEntidad", "Entidad",new { area="GestionarEmbarques"})',
             data: { id: IdEntidad, idPerfil: IdPerfil},
            contentType: 'json',
            async: true,
             type: 'GET',
             dataType: 'json',
             beforeSend: function () {

                 $("#spinnerListaEntidadSeleccionar_" + Contador).show();


             },
            error: function (jqXHR, textStatus, errorThrown) {
                $("#spinnerListaEntidadSeleccionar_" + Contador).hide();

                $("#dialogPrincipalError").modal("show");

                if (jqXHR.status == 401) {
                    $("#outputMensajePrincipalError").html("@Utilitario.Constante.SistemaConstante.Error.YouDoNotHaveAccess");
                } else {
                    $("#outputMensajePrincipalError").html("Estimado usuario, ocurrio un error inesperado detalle: "+ textStatus + " - " + errorThrown);
                }

             },
             success: function (response) {
                 window.location.href = "@Url.Action("Home", "Inicio", new { area= "GestionarDashboards" })";

             },
             complete: function (data) {

                 $("#spinnerListaEntidadSeleccionar_" + Contador).hide();
             }
         });

    }

    function CerrarSesionModo() {

        $.ajax({

            url: '@Url.Action("CerrarSesionInspector", "Entidad",new { area="GestionarEmbarques"})',
            async: true,
             contentType: 'json',
             type: 'GET',
             dataType: 'json',
             beforeSend: function () {
                 $("#btnSuperCerrarSesionModo").prop("disabled", true);
                 $("#spinnerSuperBarCerrarSesionModo").show();
             },
            error: function (jqXHR, textStatus, errorThrown) {


                $("#btnSuperCerrarSesionModo").prop("disabled", false);
                $("#spinnerSuperBarCerrarSesionModo").hide();

                $("#dialogPrincipalError").modal("show");

                if (jqXHR.status == 401) {
                    $("#outputMensajePrincipalError").html("@Utilitario.Constante.SistemaConstante.Error.YouDoNotHaveAccess");
                } else {
                    $("#outputMensajePrincipalError").html("Estimado usuario, ocurrio un error inesperado detalle: "+ textStatus + " - " + errorThrown);
                }
             },
             success: function (response) {
                 $("#btnSuperCerrarSesionModo").prop("disabled", false);
                 $("#spinnerSuperBarCerrarSesionModo").hide();
                    window.location.href = "@Url.Action("Home", "Inicio", new { area= "GestionarDashboards" })";


             },
             complete: function (data) {
                 $("#btnSuperCerrarSesionModo").prop("disabled", false);
                 $("#spinnerSuperBarCerrarSesionModo").hide();
             }
         });

    }

</script>
