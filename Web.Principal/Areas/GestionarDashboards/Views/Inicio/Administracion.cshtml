@model Web.Principal.Areas.GestionarDashboards.Models.AdminModel 
@{
    ViewBag.Title = "Administración";

    string usuariosCantidad = "0";
    var resultUsuarios = Model.Dashboard.DashboardsXEstado.Where(x => x.Proceso == Utilitario.Constante.EmbarqueConstante.Dashboard_Proceso.USUARIO_REGISTRADO).FirstOrDefault();
    if (resultUsuarios != null) {

        usuariosCantidad = resultUsuarios.Cantidad;

    }

    var meses = Model.Dashboard.DashboardsXFecha.Select(x => x.FechaTexto);
    var cantidad = Model.Dashboard.DashboardsXFecha.Select(x => x.Cantidad);
    var porcentajeUsuarioPerfil = Model.Dashboard.DashboardUsuarioPerfil.Select(x => x.Cantidad);
    var perfilUsuarioPerfil = Model.Dashboard.DashboardUsuarioPerfil.Select(x => x.PerfilNombre);

    var resultFechaMes = String.Join(", ", meses.ToArray());
    var resultPerfilUsuarioPerfil = String.Join(", ", perfilUsuarioPerfil.ToArray());

    
    var resultCantidad = String.Join(", ", cantidad.ToArray());
    var resultPorcentajeUsuarioPerfil = String.Join(", ", porcentajeUsuarioPerfil.ToArray());


}


<div class="container-xl px-4 mt-5">

    <div class="d-flex justify-content-between align-items-sm-center flex-column flex-sm-row mb-4">
        <div class="me-4 mb-3 mb-sm-0">
            <h1 class="mb-0">Dashboard</h1>
            <div class="small">
                <span class="fw-500 text-primary"></span>
                @DateTime.Now.ToLongDateString()
            </div>
        </div>


    </div>

    <div class="card card-waves mb-4 mt-5">
        <div class="card-body p-5">
            <div class="row align-items-center justify-content-between">
                <div class="col">
                    <h2 class="text-primary">Bievenido al portal Web</h2>
                    <p class="text-gray-700">Estimado colaborador desde aquí puede realizar diversas acciones referente a la administración del Portal Web.</p>

                </div>
                <div class="col d-none d-lg-block mt-xxl-n4"><img class="img-fluid px-xl-4 mt-xxl-n5" src="~/img/illustrations/statistics.svg" /></div>
            </div>
        </div>
    </div>

    <div class="row">



        <div class="col-xl-6 mb-4">
            <div class="card card-header-actions h-100">
                <div class="card-header">
                    Usuarios Registrados (Mes)

                </div>
                <div class="card-body">
                    <div class="chart-bar"><canvas id="charUsuario" width="100%" height="20"></canvas></div>
                </div>
            </div>
        </div>

        <div class="col-lg-6">
            <!-- Pie chart example-->
            <div class="card">
                <div class="card-header">Usuarios Registrados por Perfil (Año)</div>
                <div class="card-body">
                    <div class="chart-pie mb-4"><canvas id="myPieChart" width="100%" height="50"></canvas></div>
                    <div class="list-group list-group-flush">

                        @foreach (var item in Model.Dashboard.DashboardUsuarioPerfil)
                        {




                            <div class="list-group-item d-flex align-items-center justify-content-between small px-0 py-2">
                                <div class="me-3">

                                    @if (item.IdPerfil == 5)
                                    {
                                        <i class="fas fa-circle fa-sm me-1 text-blue"></i>
                                    }
                                    else if (item.IdPerfil == 6)
                                    {
                                        <i class="fas fa-circle fa-sm me-1 text-green"></i>
                                    }
                                    else if (item.IdPerfil == 7)
                                    {
                                        <i class="fas fa-circle fa-sm me-1 text-purple"></i>
                                    }
                                    else if (item.IdPerfil == 8)
                                    {
                                        <i class="fas fa-circle fa-sm me-1 text-orange"></i>
                                    }
                                    else { 
                                     <i class="fas fa-circle fa-sm me-1 text-light"></i>
                                    }



                                    @item.PerfilNombre
                                </div>
                            <div class="fw-500 text-dark">@item.Cantidad</div>
                        </div>

                        }

              
                    </div>
                </div>
            </div>
        </div>


        <div class="col-xl-6 mb-4">
            <div class="row">

                <div class="col-lg-6 col-xl-6 mb-4">
                    <div class="card bg-success text-white h-100">
                        <div class="card bg-primary border-0">
                            <div class="card-body">
                                <h5 class="text-white-50">Usuarios Registrados</h5>
                                <div class="mb-4">
                                    <span class="display-4 text-white">@usuariosCantidad</span>
                                    <span class="text-white-50"> por año</span>
                                </div>

                            </div>
                        </div>
                    </div>




                </div>


            </div>

        </div>





    </div>

    @section Scripts{

        <script src="@Url.Content("~/js/datatables/simple-datatables.js")" crossorigin="anonymous"></script>

        <script src="@Url.Content("~/lib/jquery-validation/dist/jquery.validate.js")"></script>
        <script src="@Url.Content("~/lib/jquery-validation-unobtrusive/dist/jquery.validate.unobtrusive.js")"></script>

        <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.4/Chart.min.js" crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/chartjs-plugin-datalabels/1.0.0/chartjs-plugin-datalabels.min.js" integrity="sha512-XulchVN83YTvsOaBGjLeApZuasKd8F4ZZ28/aMHevKjzrrjG0lor+T4VU248fWYMNki3Eimk+uwdlQS+uZmu8g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
        

        <script type="text/javascript">

            (Chart.defaults.global.defaultFontFamily = "Metropolis"),
                '-apple-system,system-ui,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,sans-serif';
            Chart.defaults.global.defaultFontColor = "#858796";

            function number_format(number, decimals, dec_point, thousands_sep) {

                number = (number + "").replace(",", "").replace(" ", "");
                var n = !isFinite(+number) ? 0 : +number,
                    prec = !isFinite(+decimals) ? 0 : Math.abs(decimals),
                    sep = typeof thousands_sep === "undefined" ? "," : thousands_sep,
                    dec = typeof dec_point === "undefined" ? "." : dec_point,
                    s = "",
                    toFixedFix = function (n, prec) {
                        var k = Math.pow(10, prec);
                        return "" + Math.round(n * k) / k;
                    };
                // Fix for IE parseFloat(0.55).toFixed(0) = 0;
                s = (prec ? toFixedFix(n, prec) : "" + Math.round(n)).split(".");
                if (s[0].length > 3) {
                    s[0] = s[0].replace(/\B(?=(?:\d{3})+(?!\d))/g, sep);
                }
                if ((s[1] || "").length < prec) {
                    s[1] = s[1] || "";
                    s[1] += new Array(prec - s[1].length + 1).join("0");
                }
                return s.join(dec);
            }

            function number_mes(mesDia) {

                if (mesDia == "1") {
                    return "Enero";
                }
                else if (mesDia == "2") {
                    return "Febrero";
                }
                else if (mesDia == "3") {
                    return "Marzo";
                }
                else if (mesDia == "4") {
                    return "Abril";
                }
                else if (mesDia == "5") {
                    return "Mayo";
                }
                else if (mesDia == "6") {
                    return "Junio";
                }
                else if (mesDia == "7") {
                    return "Julio";
                }
                else if (mesDia == "8") {
                    return "Agosto";
                }
                else if (mesDia == "9") {
                    return "Septiembre";
                }
                else if (mesDia == "10") {
                    return "Octubre";
                }
                else if (mesDia == "11") {
                    return "Noviembre";
                }
                else if (mesDia == "12") {
                    return "Dociembre";
                }
            }

            let background = document.getElementById("background");

            let getRandomNumber = (limit) => {
                return Math.floor(Math.random() * limit);
            };

            let getRandomColor = () => {
                let r = getRandomNumber(255);
                let g = getRandomNumber(85);
                let b = getRandomNumber(255);
                return `rgba(${r}, ${g}, ${b}, 1)`
            };

            let setBackgroundColor = () => {
                let randomColor = getRandomColor();
                return randomColor;
            };



            $(document).ready(function () {

                var mesesTexto = "@resultFechaMes";
                var mesesUsuario = mesesTexto.split(",");

                var perfilUsuarioPerfil = "@resultPerfilUsuarioPerfil";
                var resultPerfilUsuarioPerfil = perfilUsuarioPerfil.split(",");

                var listColores = [,];

                for (var i = 0; i < resultPerfilUsuarioPerfil.length; i++) {

                    listColores.push(setBackgroundColor());
                }


                var ctxUsuario = document.getElementById("charUsuario");

                var myLineChart = new Chart(ctxUsuario, {
                    type: "line",
                    plugins: [ChartDataLabels],
                    data: {
                        labels: mesesUsuario,
                        datasets: [{
                            label: "Usuarios",
                            lineTension: 0.3,
                            backgroundColor: "rgba(0, 97, 242, 0.05)",
                            borderColor: "rgba(0, 97, 242, 1)",
                            pointRadius: 3,
                            pointBackgroundColor: "rgba(0, 97, 242, 1)",
                            pointBorderColor: "rgba(0, 97, 242, 1)",
                            pointHoverRadius: 3,
                            pointHoverBackgroundColor: "rgba(0, 97, 242, 1)",
                            pointHoverBorderColor: "rgba(0, 97, 242, 1)",
                            pointHitRadius: 10,
                            pointBorderWidth: 2,
                            data: [@resultCantidad],
                            dataLabels: {

                            }
                        }]
                    },
                    options: {
                        maintainAspectRatio: false,

                        layout: {
                            padding: {
                                left: 10,
                                right: 25,
                                top: 25,
                                bottom: 0
                            }
                        },
                        scales: {
                            xAxes: [{
                                time: {
                                    unit: "date"
                                },
                                gridLines: {
                                    display: false,
                                    drawBorder: false
                                },
                                ticks: {
                                    maxTicksLimit: 12
                                }
                            }],
                            yAxes: [{
                                ticks: {
                                    maxTicksLimit: 4,
                                    padding: 10,
                                    // Include a dollar sign in the ticks
                                    callback: function (value, index, values) {
                                        return  number_format(value);
                                    }
                                },
                                gridLines: {
                                    color: "rgb(234, 236, 244)",
                                    zeroLineColor: "rgb(234, 236, 244)",
                                    drawBorder: false,
                                    borderDash: [2],
                                    zeroLineBorderDash: [2]
                                }
                            }]
                        },
                        legend: {
                            display: false
                        },
                        tooltips: {
                            titleMarginBottom: 10,
                            titleFontColor: "#6e707e",
                            titleFontSize: 14,
                            backgroundColor: "rgb(255,255,255)",
                            bodyFontColor: "#858796",
                            borderColor: "#dddfeb",
                            borderWidth: 1,
                            xPadding: 15,
                            yPadding: 15,
                            displayColors: false,
                            caretPadding: 10,
                            callbacks: {
                                label: function (tooltipItem, chart) {
                                    var datasetLabel =
                                        chart.datasets[tooltipItem.datasetIndex].label || "";
                                    return datasetLabel + ": " + number_format(tooltipItem.yLabel);
                                }
                            }
                        },
                        plugins: {
                            datalabels: {
                                color: 'blue',
                                labels: {
                                    title: {
                                        font: {
                                            weight: 'bold'
                                        }
                                    },
                                    value: {
                                        color: 'green'
                                    }
                                },
                                anchor: 'end',
                                align: 'end'
                            }
                        }



                    },


                });



                var ctx = document.getElementById("myPieChart");

                var myPieChart = new Chart(ctx, {
                    type: "doughnut",
                    plugins: [ChartDataLabels],
                    data: {
                        labels: resultPerfilUsuarioPerfil,
                        datasets: [{
                            data: [@resultPorcentajeUsuarioPerfil],
                            backgroundColor: [
                                "rgba(0, 97, 242, 1)",
                                "rgba(0, 172, 105, 1)",
                                "rgba(88, 0, 232, 1)",
                                "rgba(229, 152, 102, 1)"
                            ],
                            hoverBackgroundColor: [
                                "rgba(0, 97, 242, 0.9)",
                                "rgba(0, 172, 105, 0.9)",
                                "rgba(88, 0, 232, 0.9)",
                                "rgba(229, 152, 102, 0.9)"
                            ],
                            hoverBorderColor: "rgba(234, 236, 244, 1)"
                        }]
                    },
                    options: {
                        maintainAspectRatio: false,
                        tooltips: {
                            backgroundColor: "rgb(255,255,255)",
                            bodyFontColor: "#858796",
                            borderColor: "#dddfeb",
                            borderWidth: 1,
                            xPadding: 15,
                            yPadding: 15,
                            displayColors: false,
                            caretPadding: 10
                        },
                        legend: {
                            display: false
                        },
                        cutoutPercentage: 80,
                        plugins: {
                            datalabels: {
                                color: 'white',
                                labels: {
                                    title: {
                                        font: {
                                            weight: 'bold'
                                        }
                                    },
                                    value: {
                                        color: 'white'
                                    }
                                },

                            }
                        }
                    }
                });

            });




        </script>


    }

